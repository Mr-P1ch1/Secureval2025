#!/bin/bash

# SECUREVAL - Sistema de Evaluaciรณn de Seguridad
# Script de inicio para lanzar el sistema

# Colores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Banner del sistema
echo -e "${BLUE}"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ                           SECUREVAL                           โ"
echo "โ                  Sistema de Evaluaciรณn de Seguridad           โ"
echo "โ                        Versiรณn 2.0                            โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo -e "${NC}"

# Verificar que estamos en el directorio correcto
if [ ! -f "app/main.py" ]; then
    echo -e "${RED}โ Error: No se encontrรณ el sistema SECUREVAL en este directorio${NC}"
    echo -e "${YELLOW}๐ก Ejecuta este script desde el directorio raรญz de SECUREVAL${NC}"
    exit 1
fi

# Verificar Python 3
if ! command -v python3 &> /dev/null; then
    echo -e "${RED}โ Error: Python 3 no estรก instalado${NC}"
    echo -e "${YELLOW}๐ก Instala Python 3: sudo apt install python3${NC}"
    exit 1
fi

# Verificar tkinter
echo -e "${BLUE}๐ Verificando dependencias...${NC}"
if ! python3 -c "import tkinter" 2>/dev/null; then
    echo -e "${RED}โ Error: tkinter no estรก disponible${NC}"
    echo -e "${YELLOW}๐ก Instala tkinter: sudo apt install python3-tk${NC}"
    exit 1
fi

# Test rรกpido del sistema (opcional)
if [ "$1" = "--test" ] || [ "$1" = "-t" ]; then
    echo -e "${BLUE}๐งช Ejecutando test rรกpido del sistema...${NC}"
    python3 test_rapido.py
    exit $?
fi

# Verificar dependencias opcionales
python3 -c "import psutil" 2>/dev/null
if [ $? -eq 0 ]; then
    echo -e "${GREEN}โ Monitor de sistema disponible (psutil)${NC}"
else
    echo -e "${YELLOW}โ๏ธ  Monitor de sistema limitado (instala: pip3 install psutil)${NC}"
fi

# Mostrar informaciรณn del sistema
echo -e "${BLUE}๐ Informaciรณn del sistema:${NC}"
echo -e "   ๐ Python: $(python3 --version)"
echo -e "   ๐ Directorio: $(pwd)"
echo -e "   ๐ป Usuario: $(whoami)"

# Lanzar el sistema
echo -e "\n${GREEN}๐ Iniciando SECUREVAL...${NC}"
echo -e "${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"

# Ejecutar el sistema principal
python3 -m app.main

# Capturar cรณdigo de salida
exit_code=$?

echo -e "\n${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"

if [ $exit_code -eq 0 ]; then
    echo -e "${GREEN}โ SECUREVAL finalizado correctamente${NC}"
else
    echo -e "${RED}โ SECUREVAL terminรณ con errores (cรณdigo: $exit_code)${NC}"
fi

echo -e "${BLUE}๐ ยกGracias por usar SECUREVAL!${NC}"
exit $exit_code
